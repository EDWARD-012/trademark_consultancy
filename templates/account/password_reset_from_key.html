{% extends 'base.html' %}
{% load static %}
{% load allauth %}

{% block content %}
<div class="min-h-screen flex flex-col justify-center py-12 px-6 lg:px-8 relative overflow-hidden">
    
    <div class="fixed top-1/4 left-1/4 w-[40%] h-[40%] rounded-full bg-lovable-purple/10 blur-[120px] pointer-events-none"></div>
    <div class="fixed bottom-1/4 right-1/4 w-[40%] h-[40%] rounded-full bg-lovable-blue/10 blur-[120px] pointer-events-none"></div>

    <div class="sm:mx-auto sm:w-full sm:max-w-md text-center relative z-10 mb-8">
        <img class="mx-auto h-12 w-auto brightness-110 mb-6" src="{% static 'images/logo.png' %}" alt="Logo">
        <h2 class="text-3xl font-extrabold text-white tracking-tight">
            {% if token_fail %}Link Expired{% else %}Set New Password{% endif %}
        </h2>
    </div>

    <div class="sm:mx-auto sm:w-full sm:max-w-md relative z-10">
        <div class="glass p-8 md:p-10 rounded-[40px] border border-white/10 shadow-2xl backdrop-blur-2xl">
            
            {% if token_fail %}
                <div class="text-center">
                    <div class="mx-auto flex items-center justify-center h-20 w-20 rounded-3xl bg-red-500/10 border border-red-500/20 mb-6">
                        <i class="fa-solid fa-triangle-exclamation text-3xl text-red-500 animate-pulse"></i>
                    </div>
                    <h3 class="text-lg font-bold text-red-400 mb-2">Invalid or Expired Link</h3>
                    <p class="text-sm text-slate-400 leading-relaxed mb-8">
                        This password reset link is invalid or has expired (links last for 5 minutes).
                    </p>
                    <a href="{% url 'account_reset_password' %}" class="block w-full text-center py-4 bg-white/5 border border-red-500/30 text-red-400 font-bold rounded-2xl hover:bg-red-500/10 transition-all duration-300">
                        Request New Link
                    </a>
                </div>

            {% else %}
                <p class="text-center text-sm text-slate-400 mb-8 leading-relaxed">
                    Enter your new password below to regain access to your Manyan IP account.
                </p>

                <form method="POST" action="{{ action_url }}" class="space-y-6">
                    {% csrf_token %}
                    
                    {% if form.errors %}
                    <div class="rounded-2xl bg-red-500/10 p-4 border border-red-500/20 mb-4 text-xs text-red-400">
                        {{ form.non_field_errors }}
                    </div>
                    {% endif %}

                    {% for field in form %}
                    <div class="space-y-1">
                        <label for="{{ field.id_for_label }}" class="text-[10px] font-bold text-slate-500 uppercase tracking-widest ml-2">
                            {{ field.label }}
                        </label>
                        <input type="password" name="{{ field.name }}" id="{{ field.id_for_label }}" required
                            class="w-full bg-white/5 border border-white/10 rounded-2xl px-5 py-3.5 text-white text-sm focus:border-lovable-purple focus:ring-1 focus:ring-lovable-purple outline-none transition placeholder:text-slate-600"
                            placeholder="••••••••">
                        
                        {% if field.help_text %}
                        <p class="mt-2 text-[10px] text-slate-500 leading-relaxed px-2">{{ field.help_text|safe }}</p>
                        {% endif %}
                        
                        {% if field.errors %}
                        <p class="mt-2 text-xs text-red-400 ml-2 italic">{{ field.errors.0 }}</p>
                        {% endif %}
                    </div>
                    {% endfor %}

                    <button type="submit" class="w-full flex justify-center py-4 px-4 bg-gradient-to-r from-lovable-purple to-lovable-blue text-white font-bold rounded-2xl shadow-lg shadow-lovable-purple/20 hover:shadow-lovable-purple/40 hover:scale-[1.02] active:scale-95 transition-all">
                        Change Password
                    </button>
                </form>
            {% endif %}

        </div>
    </div>
</div>
{% endblock %}